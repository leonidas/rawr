(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c,d,e){this.width=c,this.height=d,this.margin=e,this.updateDataLayer=b(this.updateDataLayer,this),this.drawYLabels=b(this.drawYLabels,this),this.drawXLabels=b(this.drawXLabels,this),this.calculateScale=b(this.calculateScale,this),this.draw=b(this.draw,this),this.getLayerCanvas=b(this.getLayerCanvas,this),this.parent=a.append("div").classed("backgroundCanvas",!0).style("font-family","Helvetica").style("font-size","11").style("position","relative").style("width",this.width).style("height",this.height),this.axesCanvas=this.getLayerCanvas("axes")}return a.prototype.getLayerCanvas=function(a){var b,c;return this.canvases==null&&(this.canvases={}),(c=(b=this.canvases)[a])!=null?c:b[a]=this.parent.append("div").classed(""+a+"Layer",!0).style("position","absolute").style("left",0).style("right",0).style("width",this.width).style("height",this.height)},a.prototype.draw=function(a,b){var c=this;return this.calculateScale(a),this.drawXLabels(),this.drawYLabels(),_.each(a,function(a,d){return c.updateDataLayer(a,b,d)})},a.prototype.calculateScale=function(a){var b,c,d,e,f,g,h=this;return e=d3.max(a,function(a){return d3.sum(a,function(a){return a.width})}),b=d3.max(_.flatten(a),function(a){return a.height}),c=d3.scale.linear().domain([0,e]).range([this.margin,this.width-this.margin]),d=d3.scale.linear().domain([0,b]).range([this.height-this.margin,this.margin]),this.oldXScale=(f=this.xScale)!=null?f:c,this.oldYScale=(g=this.yScale)!=null?g:d,this.xScale=c,this.yScale=d},a.prototype.drawXLabels=function(){var a,b=this;return a=30,this.xLabels=this.axesCanvas.selectAll(".x-label").data(this.xScale.ticks(10),String),this.xLabels.enter().append("div").attr("class","x-label").style("position","absolute").style("text-align","center").style("left",function(c){return b.oldXScale(c)-a/2}).style("width",a).style("top",this.height-this.margin+5).style("opacity","0").text(String),this.xLabels.transition().duration(500).style("opacity","1").style("left",function(c){return b.xScale(c)-a/2}),this.xLabels.exit().transition().duration(500).style("left",function(c){return b.xScale(c)-a/2}).style("opacity","0").remove()},a.prototype.drawYLabels=function(){var a,b=this;return a=12,this.yLabels=this.axesCanvas.selectAll(".y-label").data(this.yScale.ticks(10),String),this.yLabels.enter().append("div").attr("class","y-label").style("position","absolute").style("text-align","right").style("left",0).style("width",this.margin-5).style("top",function(c){return b.oldYScale(c)-a/2}).style("height",a).style("opacity","0").text(String),this.yLabels.transition().duration(500).style("opacity","1").style("top",function(c){return b.yScale(c)-a/2}),this.yLabels.exit().transition().duration(500).style("top",function(c){return b.yScale(c)-a/2}).style("opacity","0").remove()},a.prototype.updateDataLayer=function(a,b,c){var d,e,f,g,h,i,j,k=this;return d=function(a){var b;return b={},_(a).each(function(a){var c;return b[c=a.title]==null&&(b[c]=0),a.__indexWithinGroup__=b[a.title],b[a.title]+=1})},d(a),e=function(a){var b;return b=0,_(a).map(function(a){return a.__startX__=b,b+=a.width})},e(a),console.log(a),f=this.getLayerCanvas(c),i=this.xScale,j=this.yScale,g=this.height-this.margin-3,h=f.selectAll(".rect").data(a,function(a){return""+a.title+"-"+a.__indexWithinGroup__}),h.style("position","absolute").text(function(a){return a.__indexWithinGroup__===0?a.title:""}).transition().duration(500).style("left",function(a){return Math.round(i(a.__startX__))}).style("right",function(a){return Math.round(k.width-i(a.__startX__+a.width))}).style("top",function(a){return Math.round(j(a.height))}).style("bottom",this.margin),h.enter().append("div").attr("class","rect").attr("style",function(a){return b[a.title]}).style("position","absolute").style("left",function(a){return Math.round(i(a.__startX__))}).style("right",function(a){return Math.round(k.width-i(a.__startX__+a.width))}).style("top",this.height-this.margin).style("bottom",this.margin).text(function(a){return a.__indexWithinGroup__===0?a.title:""}).transition().delay(500).duration(500).style("top",function(a){return Math.round(j(a.height))}),h.exit().remove()},a}(),window.Chart=a}).call(this);