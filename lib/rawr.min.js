(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c,d,e,f){this.width=c,this.height=d,this.margin=e,this.styles=f,this._updateDataLayer=b(this._updateDataLayer,this),this._addOwnParamsToData=b(this._addOwnParamsToData,this),this._drawYLabels=b(this._drawYLabels,this),this._drawXLabels=b(this._drawXLabels,this),this._calculateScale=b(this._calculateScale,this),this._getLayerCanvas=b(this._getLayerCanvas,this),this._trackAllTimeSeriesNames=b(this._trackAllTimeSeriesNames,this),this._hierarchizeData=b(this._hierarchizeData,this),this._drawPage=b(this._drawPage,this),this.setData=b(this.setData,this),this.parent=a.append("div").classed("backgroundCanvas",!0).style("font-family","Helvetica").style("font-size","11").style("position","relative").style("width",this.width).style("height",this.height),this.axesCanvas=this._getLayerCanvas("axes"),this.allTimeSeriesNames=[]}return a.prototype.setData=function(a){return this.data=this._hierarchizeData(a),this.pageNames=_.keys(this.data),this.allTimeSeriesNames=this._trackAllTimeSeriesNames(this.allTimeSeriesNames,this.data),this.currentPageNumber=0,this._calculateScale(this.data),this._drawXLabels(),this._drawYLabels(),this._drawPage(this.pageNames[this.currentPageNumber])},a.prototype._drawPage=function(a){var b=this;return _.each(this.allTimeSeriesNames,function(c){var d;return b._updateDataLayer(c,(d=b.data[a][c])!=null?d:[])})},a.prototype._hierarchizeData=function(a){var b,c=this;return b=_.groupBy(a,"page"),_.each(_.keys(b),function(a){return b[a]=_.groupBy(b[a],"series")}),b},a.prototype._trackAllTimeSeriesNames=function(a,b){var c;return c=_.uniq(_.flatten(_.map(b,function(a){return _.keys(a)}))),_.uniq(a.concat(c))},a.prototype._getLayerCanvas=function(a){var b,c;return this.canvases==null&&(this.canvases={}),(c=(b=this.canvases)[a])!=null?c:b[a]=this.parent.append("div").classed(""+a+"Layer",!0).style("position","absolute").style("left",0).style("right",0).style("width",this.width).style("height",this.height)},a.prototype._calculateScale=function(a){var b,c,d,e,f,g,h=this;return b=d3.max(_.values(a),function(a){return d3.max(_.values(a),function(a){return d3.sum(a,function(a){return a.width})})}),c=d3.max(_.values(a),function(a){return d3.max(_.values(a),function(a){return d3.max(a,function(a){return a.height})})}),d=d3.scale.linear().domain([0,b]).range([this.margin,this.width-this.margin]),e=d3.scale.linear().domain([0,c]).range([this.height-this.margin,this.margin]),this.oldXScale=(f=this.xScale)!=null?f:d,this.oldYScale=(g=this.yScale)!=null?g:e,this.xScale=d,this.yScale=e},a.prototype._drawXLabels=function(){var a,b=this;return a=30,this.xLabels=this.axesCanvas.selectAll(".x-label").data(this.xScale.ticks(10),String),this.xLabels.enter().append("div").attr("class","x-label").style("position","absolute").style("text-align","center").style("left",function(c){return b.oldXScale(c)-a/2}).style("width",a).style("top",this.height-this.margin+5).style("opacity","0").text(String),this.xLabels.transition().duration(500).style("opacity","1").style("left",function(c){return b.xScale(c)-a/2}),this.xLabels.exit().transition().duration(500).style("left",function(c){return b.xScale(c)-a/2}).style("opacity","0").remove()},a.prototype._drawYLabels=function(){var a,b=this;return a=12,this.yLabels=this.axesCanvas.selectAll(".y-label").data(this.yScale.ticks(10),String),this.yLabels.enter().append("div").attr("class","y-label").style("position","absolute").style("text-align","right").style("left",0).style("width",this.margin-5).style("top",function(c){return b.oldYScale(c)-a/2}).style("height",a).style("opacity","0").text(String),this.yLabels.transition().duration(500).style("opacity","1").style("top",function(c){return b.yScale(c)-a/2}),this.yLabels.exit().transition().duration(500).style("top",function(c){return b.yScale(c)-a/2}).style("opacity","0").remove()},a.prototype._addOwnParamsToData=function(a){var b,c,d=this;return c={},_(a).each(function(a){var b;return c[b=a.title]==null&&(c[b]=0),a.__indexWithinGroup__=c[a.title],c[a.title]+=1}),b=0,_(a).each(function(a){return a.__startX__=b,b+=a.width})},a.prototype._updateDataLayer=function(a,b){var c,d,e,f,g,h,i=this;return this._addOwnParamsToData(b),c=this._getLayerCanvas(a),g=this.xScale,h=this.yScale,e=this.height-this.margin-3,f=c.selectAll(".rect").data(b,function(a){return""+a.title+"-"+a.subtitle}),d=1e-8,f.style("position","absolute").text(function(a){return a.__indexWithinGroup__===0?a.title:""}).transition().duration(500).style("left",function(a){return Math.round(g(a.__startX__)+d)}).style("right",function(a){return Math.round(i.width-g(a.__startX__+a.width)-d)}).style("top",function(a){return Math.round(h(a.height))}).style("bottom",this.margin),f.enter().append("div").attr("class","rect").attr("style",function(a){return i.styles[a.title]}).style("position","absolute").style("left",function(a){return Math.round(g(a.__startX__)+d)}).style("right",function(a){return Math.round(i.width-g(a.__startX__+a.width)-d)}).style("top",this.height-this.margin).style("bottom",this.margin).style("color","rgba(0,0,0,0)").text(function(a){return a.__indexWithinGroup__===0?a.title:""}).transition().delay(500).duration(500).style("color","rgba(0,0,0,1)").style("top",function(a){return Math.round(h(a.height))}),f.exit().transition().duration(250).style("opacity",0).remove()},a}(),window.Chart=a}).call(this);