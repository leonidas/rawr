(function(){var a;a=function(){function a(a,b,c,d){this.width=b,this.height=c,this.margin=d,this.parent=a.append("div").classed("backgrondCanvas",!0).style("font-family","Helvetica").style("font-size","11").style("position","relative").style("width",this.width).style("height",this.height),this.axesCanvas=this.parent.append("svg:svg").classed("axesCanvas",!0).style("position","absolute").style("left",0).style("right",0).style("width",this.width).style("height",this.height),this.chartCanvases={}}return a.prototype.getChartCanvas=function(a){var b,c;return(c=(b=this.chartCanvases)[a])!=null?c:b[a]=this.parent.append("svg:svg").classed("chartCanvas",!0).style("position","absolute").style("left",0).style("right",0).style("width",this.width).style("height",this.height)},a.prototype.draw=function(a,b){return this.calculateScale(a),this.drawXLabels(),this.drawYLabels(),this.drawDataRectangles(a,b)},a.prototype.calculateScale=function(a){var b,c,d,e;return c=d3.sum(a,function(a){return a.width}),b=d3.max(a,function(a){return a.height}),this.oldXScale=(d=this.xScale)!=null?d:this.margin,this.oldYScale=(e=this.yScale)!=null?e:this.height-this.margin,this.xScale=d3.scale.linear().domain([0,c]).range([this.margin,this.width-this.margin]),this.yScale=d3.scale.linear().domain([0,b]).range([this.height-this.margin,this.margin])},a.prototype.drawXLabels=function(){return this.xLabels=this.axesCanvas.selectAll(".x-label").data(this.xScale.ticks(10),String),this.xLabels.enter().append("text").attr("class","x-label").attr("text-anchor","middle").attr("x",this.oldXScale).attr("y",this.height-this.margin+15).text(String),this.xLabels.transition().duration(500).attr("x",this.xScale),this.xLabels.exit().transition().duration(500).attr("x",this.xScale).style("opacity","0").remove()},a.prototype.drawYLabels=function(){return this.yLabels=this.axesCanvas.selectAll(".y-label").data(this.yScale.ticks(10),String),this.yLabels.enter().append("text").attr("class","y-label").attr("alignment-baseline","middle").attr("text-anchor","end").attr("x",this.margin-5).attr("y",this.oldYScale).text(String),this.yLabels.transition().duration(500).attr("y",this.yScale),this.yLabels.exit().transition().duration(500).attr("y",this.yScale).style("opacity","0").remove()},a.prototype.drawDataRectangles=function(a,b,c){var d,e,f,g,h,i,j,k;return c==null&&(c="layer1"),d=function(a){var b;return b={},_(a).each(function(a){var c;return b[c=a.title]==null&&(b[c]=0),a.__indexWithinGroup__=b[a.title],b[a.title]+=1})},d(a),e=function(a){var b;return b=0,_(a).map(function(a){return a.__startX__=b,b+=a.width})},e(a),f=this.getChartCanvas(c),j=this.xScale,k=this.yScale,g=this.height-this.margin-3,console.log(a),i=f.selectAll("."+c).data(a,function(a){return""+a.title+"-"+a.__indexWithinGroup__}),i.select("rect").attr("style",function(a){return b[a.title]}).transition().duration(500).attr("x",function(a){return j(a.__startX__)}).attr("width",function(a){return j(a.__startX__+a.width)-j(a.__startX__)}).attr("y",function(a){return k(a.height)}).attr("height",function(a){return a.height>0?k(0)-k(a.height):3}),h=i.enter().append("g").attr("class",c),h.append("rect").attr("style",function(a){return b[a.title]}).attr("x",function(a){return j(a.__startX__)}).attr("width",function(a){return j(a.__startX__+a.width)-j(a.__startX__)}).attr("y",function(a){return k(0)}).transition().delay(500).duration(500).attr("x",function(a){return j(a.__startX__)}).attr("width",function(a){return j(a.__startX__+a.width)-j(a.__startX__)}).attr("y",function(a){return k(a.height)}).attr("height",function(a){return a.height>0?k(0)-k(a.height):3}),h.append("g").attr("class","box-label").append("text").attr("transform","rotate(270)"),i.select("g").attr("transform",function(a){return"translate("+(j(a.__startX__)+11)+","+g+")"}).select("text").text(function(a){return a.__indexWithinGroup__===0?a.title:""}),i.exit().remove()},a}(),window.Chart=a}).call(this);