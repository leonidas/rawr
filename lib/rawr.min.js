(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a,c,d,e){this.width=c,this.height=d,this.margin=e,this.updateDataLayer=b(this.updateDataLayer,this),this.addOwnParamsToData=b(this.addOwnParamsToData,this),this.drawYLabels=b(this.drawYLabels,this),this.drawXLabels=b(this.drawXLabels,this),this.calculateScale=b(this.calculateScale,this),this.getLayerCanvas=b(this.getLayerCanvas,this),this.getLayerCanvas=b(this.getLayerCanvas,this),this.hierarchizeData=b(this.hierarchizeData,this),this.drawPage=b(this.drawPage,this),this.setData=b(this.setData,this),this.parent=a.append("div").classed("backgroundCanvas",!0).style("font-family","Helvetica").style("font-size","11").style("position","relative").style("width",this.width).style("height",this.height),this.axesCanvas=this.getLayerCanvas("axes")}return a.prototype.setData=function(a,b){return this.data=this.hierarchizeData(a),console.log(this.data),this.pageNames=_.keys(this.data),this.currentPageNumber=0,this.calculateScale(this.data),this.drawXLabels(),this.drawYLabels(),this.drawPage(this.pageNames[this.currentPageNumber],b)},a.prototype.drawPage=function(a,b){var c=this;return _.each(this.data[a],function(a,d){return c.updateDataLayer(d,a,b)})},a.prototype.hierarchizeData=function(a){var b,c=this;return b=_.groupBy(a,"page"),_.each(_.keys(b),function(a){return b[a]=_.groupBy(b[a],"series")}),b},a.prototype.getLayerCanvas=function(a){var b,c;return this.canvases==null&&(this.canvases={}),(c=(b=this.canvases)[a])!=null?c:b[a]=this.parent.append("div").classed(""+a+"Layer",!0).style("position","absolute").style("left",0).style("right",0).style("width",this.width).style("height",this.height)},a.prototype.getLayerCanvas=function(a){var b,c;return this.canvases==null&&(this.canvases={}),(c=(b=this.canvases)[a])!=null?c:b[a]=this.parent.append("div").classed(""+a+"Layer",!0).style("position","absolute").style("left",0).style("right",0).style("width",this.width).style("height",this.height)},a.prototype.calculateScale=function(a){var b,c,d,e,f,g,h=this;return b=d3.max(_.values(a),function(a){return d3.max(_.values(a),function(a){return d3.sum(a,function(a){return a.width})})}),c=d3.max(_.values(a),function(a){return d3.max(_.values(a),function(a){return d3.max(a,function(a){return a.height})})}),console.log(b),console.log(c),d=d3.scale.linear().domain([0,b]).range([this.margin,this.width-this.margin]),e=d3.scale.linear().domain([0,c]).range([this.height-this.margin,this.margin]),this.oldXScale=(f=this.xScale)!=null?f:d,this.oldYScale=(g=this.yScale)!=null?g:e,this.xScale=d,this.yScale=e},a.prototype.drawXLabels=function(){var a,b=this;return a=30,this.xLabels=this.axesCanvas.selectAll(".x-label").data(this.xScale.ticks(10),String),this.xLabels.enter().append("div").attr("class","x-label").style("position","absolute").style("text-align","center").style("left",function(c){return b.oldXScale(c)-a/2}).style("width",a).style("top",this.height-this.margin+5).style("opacity","0").text(String),this.xLabels.transition().duration(500).style("opacity","1").style("left",function(c){return b.xScale(c)-a/2}),this.xLabels.exit().transition().duration(500).style("left",function(c){return b.xScale(c)-a/2}).style("opacity","0").remove()},a.prototype.drawYLabels=function(){var a,b=this;return a=12,this.yLabels=this.axesCanvas.selectAll(".y-label").data(this.yScale.ticks(10),String),this.yLabels.enter().append("div").attr("class","y-label").style("position","absolute").style("text-align","right").style("left",0).style("width",this.margin-5).style("top",function(c){return b.oldYScale(c)-a/2}).style("height",a).style("opacity","0").text(String),this.yLabels.transition().duration(500).style("opacity","1").style("top",function(c){return b.yScale(c)-a/2}),this.yLabels.exit().transition().duration(500).style("top",function(c){return b.yScale(c)-a/2}).style("opacity","0").remove()},a.prototype.addOwnParamsToData=function(a){var b,c,d=this;return c={},_(a).each(function(a){var b;return c[b=a.title]==null&&(c[b]=0),a.__indexWithinGroup__=c[a.title],c[a.title]+=1}),b=0,_(a).map(function(a){return a.__startX__=b,b+=a.width})},a.prototype.updateDataLayer=function(a,b,c){var d,e,f,g,h,i,j=this;return this.addOwnParamsToData(b),d=this.getLayerCanvas(a),h=this.xScale,i=this.yScale,f=this.height-this.margin-3,g=d.selectAll(".rect").data(b,function(a){return""+a.title+"-"+a.subtitle}),e=1e-8,g.style("position","absolute").text(function(a){return a.__indexWithinGroup__===0?a.title:""}).transition().duration(500).style("left",function(a){return Math.round(h(a.__startX__)+e)}).style("right",function(a){return Math.round(j.width-h(a.__startX__+a.width)-e)}).style("top",function(a){return Math.round(i(a.height))}).style("bottom",this.margin),g.enter().append("div").attr("class","rect").attr("style",function(a){return c[a.title]}).style("position","absolute").style("left",function(a){return Math.round(h(a.__startX__)+e)}).style("right",function(a){return Math.round(j.width-h(a.__startX__+a.width)-e)}).style("top",this.height-this.margin).style("bottom",this.margin).style("color","rgba(0,0,0,0)").text(function(a){return a.__indexWithinGroup__===0?a.title:""}).transition().delay(500).duration(500).style("color","rgba(0,0,0,1)").style("top",function(a){return Math.round(i(a.height))}),g.exit().transition().duration(250).style("opacity",0).remove()},a}(),window.Chart=a}).call(this);